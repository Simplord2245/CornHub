DROP DATABASE IF EXISTS CornHub;
CREATE DATABASE CornHub;
USE CornHub;
CREATE TABLE Movies (
    movie_id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    nation VARCHAR(50),
    date_added DATETIME DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE SubMovies (
    submovie_id INT AUTO_INCREMENT PRIMARY KEY,
    movie_id INT,
    submovie_title VARCHAR(255) NOT NULL,
    submovie_description TEXT,
    release_year INT,
    image VARCHAR(255),
    trailer_url VARCHAR(255),
    date_added DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (movie_id) REFERENCES Movies(movie_id) ON DELETE CASCADE
);
CREATE TABLE Episodes (
    episode_id INT AUTO_INCREMENT PRIMARY KEY,
    submovie_id INT,
    episode_number INT,
    duration INT,
    url VARCHAR(255),
    date_added DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (submovie_id) REFERENCES SubMovies(submovie_id) ON DELETE CASCADE
);
CREATE TABLE Genres (
    genre_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE
);
CREATE TABLE Movies_Genres (
    movie_id INT,
    genre_id INT,
    PRIMARY KEY (movie_id, genre_id),
    FOREIGN KEY (movie_id) REFERENCES Movies(movie_id) ON DELETE CASCADE,
    FOREIGN KEY (genre_id) REFERENCES Genres(genre_id) ON DELETE CASCADE
);
CREATE TABLE Users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    profile_picture VARCHAR(255),
    date_joined DATETIME DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE Ratings (
    user_id INT,
    movie_id INT,
    rating INT CHECK (rating >= 1 AND rating <= 10),
    date_rated DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, movie_id),
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (movie_id) REFERENCES Movies(movie_id) ON DELETE CASCADE
);
CREATE TABLE Watch_History (
    watch_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    movie_id INT,
    watch_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (movie_id) REFERENCES Movies(movie_id) ON DELETE CASCADE
);
CREATE TABLE Comments (
    comment_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    movie_id INT,
    comment TEXT,
    date_commented DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (movie_id) REFERENCES Movies(movie_id) ON DELETE CASCADE
);
INSERT INTO Movies (title, nation) VALUES
('Naruto', 'Nhật Bản'),
('Fairy Tail', 'Nhật Bản'),
('One Piece', 'Nhật Bản'),
('Bleach', 'Nhật Bản'),
('Pokemon', 'Nhật Bản'),
('Arcane', 'Mỹ'),
('Dandadan', 'Nhật Bản'),
('Dragon Ball', 'Nhật Bản'),
('Date A Live', 'Nhật Bản'),
('Attack On Titan', 'Nhật Bản'),
('Boku no Hero Academia', 'Nhật Bản'),
('Jujutsu Kaisen', 'Nhật Bản');
INSERT INTO SubMovies (movie_id, submovie_title, submovie_description, release_year, image, trailer_url) VALUES
(1, 'Naruto', 'Phần đầu trong hai loạt phim hoạt hình được sản xuất bởi Studio Pierrot và Aniplex đã công chiếu khắp Nhật Bản trên mạng lưới truyền hình TV Tokyo và mạng lưới hoạt hình truyền hình vệ tinh Animax vào ngày 3 tháng 10 năm 2002. Phần đầu tiên kéo dài trong 9 mùa 12 năm trước, hồ ly 9 đuôi tấn công làng ninja Mộc Diệp, Hokage Đệ Tứ đã đánh bại và phong ấn vào cậu bé Naruto.Từ đó, Naruto bị mọi người xa lánh, vậy nên cậu tìm ra cách được thừa nhận và chú ý duy nhất – qua các trò phá phách và nghịch ngợm.Câu chuyện chính bám theo sự trưởng thành và tiến bộ của Naruto và bạn cậu khi làm ninja, và nhấn mạnh mối quan hệ giữa họ và sự ảnh hưởng của quá khứ đến tính cách họ. Naruto tìm được hai người bạn đồng hành cùng là Uchiha Sasuke và Haruno Sakura, cuộc phiêu lưu bắt đầu.', '2002', 'naruto.jpg', 'https://www.youtube.com/watch?v=-G9BqkgZXRA'),
(1, 'Naruto: Huyền thoại đá Gelel', 'Câu chuyện mở đầu với trận chiến tại một bờ biển hoang vắng vào ban đêm giữa ninja làng Cát và những tên khổng lồ mặc chiếc áo giáp nâu. Những ninja làng Cát đang hoàn toàn bị thất thế trước những tên to lớn này. Đúng lúc đó Gaara và Kankuro xuất hiện để bảo vệ họ. Do lá chắn cát của Gaara quá mạnh nên những tên to lớn kia buộc phải rút lui. Họ nhìn thấy những tên ấy chạy ra một con tàu chiến giữa biển. 2 ninja quyết chèo thuyền ra để tìm hiểu rõ về con tàu ấy, mặc cho người khác khuyên ngăn, khi bóng họ và tàu khuất dần, tất cả chỉ nghe thấy tiếng kêu thất thanh và không thấy họ quay lại nữa.', 2005, 'naruto1.jpg', 'https://www.youtube.com/watch?v=4EiTuiYlvgo'),
(1, 'Naruto: Sức Mạnh Vĩ Thú', 'Tiếp nối phần I sau khi cậu bé cùng sư phụ Jiraiya của mình đi tập luyện xa trở về làng Lá. Sau khi huấn luyện 2 năm rưỡi với Jiraiya, Naruto trở về làng Lá, đoàn tụ với những người bạn cậu đã chia tay, và lập lại Nhóm 7, giờ được gọi là Nhóm Kakashi, với Sai thế chỗ Sasuke. Tất cả những người bạn của Naruto đều đã trưởng thành và thăng cấp, có người hơn người khác. Không giống như phần đầu khi chúng chỉ đóng vai trò phụ, tổ chức Akatsuki chiếm lấy vai trò đối nghịch chính trong tham vọng thống trị thế giới.', 2007, 'naruto2.jpg', 'https://youtu.be/1dy2zPPrKD0'),
(1, 'Naruto: Trận chiến cuối cùng', 'Hai năm sau khi các sự kiện của cuộc Chiến tranh Thế giới Thứ tư Shinobi, mặt trăng bắt đầu đi xuống về phía Trái đất. Với trăng bây giờ là một ngôi sao băng đó sẽ phá hủy tất cả mọi thứ về tác động, Naruto phải đối phó với mối đe dọa này. Trong khi đó, Toneri Ōtsutsuki, một hậu duệ của Hamura Ōtsutsuki xác định thực hiện về di sản tổ tiên mình, xuất hiện và bắt cóc Hanabi Hyuga sau khi thất bại trong việc bắt lấy Hinata. Naruto, Hinata, Sakura, Sai, và Shikamaru được triển khai để đi giải cứu Hanabi. Ngoài ra Toneri và Hinata cùng tham gia với anh. Tại thời điểm đó, Toneri đánh cắp Byakugan Hanabi và cấy chúng trong hốc mắt trống rỗng của mình, đánh thức các Tenseigan kín bởi con cháu của Hamura trong thiên niên kỷ qua. Ông cũng thành công trong việc bắt cóc Hinata, đề nghị cô kết hôn với anh ta. Cuối cùng, Naruto đã đánh bại Toneri, dừng lại mặt trăng rơi xuống, và cứu lấy Hinata. Naruto sau đó thú nhận tình yêu của mình cho Hinata cùng với hai nụ hôn. Bộ phim kết thúc với một loạt các đèn flash-rực rỡ cùng đám cưới Naruto và Hinata và con cái của họ, Boruto và Himawari.', 2007, 'naruto3.jpg', 'https://youtu.be/tA3yE4_t6SY');
INSERT INTO Episodes (submovie_id, episode_number, duration, url) VALUES
(1, 1, 24, 'https://www.youtube.com/watch?v=-SBBef-OEiE'),
(1, 2, 24, 'https://www.youtube.com/watch?v=NP_unUdyIpU&t=3s'),
(1, 3, 24, 'https://www.youtube.com/watch?v=Hiy2oGwNc1I'),
(1, 4, 24, 'https://www.youtube.com/watch?v=cDJwpPJIaRA'),
(1, 5, 24, 'https://www.youtube.com/watch?v=dC5aaFX0D8U'),
(1, 6, 24, 'https://www.youtube.com/watch?v=CGhK2NPKtQE'),
(1, 7, 24, 'https://www.youtube.com/watch?v=MucyhPWlx28'),
(1, 8, 24, 'https://www.youtube.com/watch?v=JtfyJemtkt0'),
(1, 9, 24, 'https://www.youtube.com/watch?v=QuMJjYgHsiM'),
(1, 10, 24, 'https://www.youtube.com/watch?v=TesYVK3lHkg'),
(2, 1, 97, 'https://www.youtube.com/watch?v=tE6kJryE_uc'),
(1, 1, 24, 'https://youtu.be/skluj-DE5xI'),
(3, 2, 24, 'https://youtu.be/5q1yhqqNeU0'),
(3, 3, 24, 'https://youtu.be/PuytaM3WWoE'),
(3, 4, 24, 'https://youtu.be/l2bqqiB1R-M'),
(3, 5, 24, 'https://youtu.be/NPCwiFcYvEM'),
(3, 6, 24, 'https://youtu.be/WPGAK-I-90o'),
(3, 7, 24, 'https://youtu.be/LhKoZhKr2y8'),
(3, 8, 24, 'https://youtu.be/zEVSt0DZ7DY'),
(3, 9, 24, 'https://youtu.be/8jX1ced_3Jc'),
(3, 10, 24, 'https://youtu.be/fLpeigFMVX0'),
(4, 1, 112, 'https://youtu.be/_uKbx152unY');

INSERT INTO Genres (name) 
VALUES
('Shounen'),
('Shoujo'),
('Seinen'),
('Josei'),
('Isekai'),
('Mecha'),
('Slice of Life'),
('Fantasy'),
('Sports'),
('Psychological'),
('Horror'),
('Romance'),
('Comedy'),
('Mystery'),
('Harem'),
('Action'),
('Sci-Fi'),
('Adventure');
INSERT INTO Movies_Genres (movie_id, genre_id) VALUES
(1, 1), (1, 16), (1, 3), (1, 8),
(2, 1), (2, 16), (2, 8), (2, 12),
(3, 1), (3, 16), (3, 8), (3, 13),
(4, 1), (4, 16), (4, 8), (4, 6),
(5, 1), (5, 8), (5, 12),
(6, 17), (6, 18),
(7, 1), (7, 16), (7, 8), (7, 13),
(8, 1), (8, 16), (8, 8), (8, 6),
(9, 1), (9, 16), (9, 8), (9, 12),
(10, 1), (10, 16), (10, 8), (10, 17),
(11, 1), (11, 16), (11, 8), (11, 12),
(12, 1), (12, 16), (12, 8), (12, 10);
INSERT INTO Users (username, email, password, full_name, profile_picture)
VALUES
('narutoFan', 'naruto@anime.com', '$2y$12$4Sx/qagiYWaFx67llP.hrOJB4mkUnrHaXn7jZJXLHJaAKk6EsZ0FW', 'Naruto Uzumaki', 'https://example.com/naruto-profile.jpg'),
('aotFan', 'aot@anime.com', '$2y$12$4Sx/qagiYWaFx67llP.hrOJB4mkUnrHaXn7jZJXLHJaAKk6EsZ0FW', 'Eren Jaeger', 'https://example.com/aot-profile.jpg'),
('onePieceFan', 'onepiece@anime.com', '$2y$12$4Sx/qagiYWaFx67llP.hrOJB4mkUnrHaXn7jZJXLHJaAKk6EsZ0FW', 'Monkey D. Luffy', 'https://example.com/onepiece-profile.jpg');
INSERT INTO Ratings (user_id, movie_id, rating)
VALUES
(1, 1, 9), (2, 2, 8), (3, 3, 10), (1, 4, 7), (2, 5, 10),
(3, 6, 9), (1, 7, 6), (2, 8, 8), (3, 9, 7), (1, 10, 9);
INSERT INTO Watch_History (user_id, movie_id)
VALUES
(1, 1), (2, 2), (3, 3), (1, 4), (2, 5),
(3, 6), (1, 7), (2, 8), (3, 9), (1, 10);
INSERT INTO Comments (user_id, movie_id, comment)
VALUES
(1, 1, 'Great story, but the pacing could have been better.'),
(2, 2, 'Amazing world-building and intense action scenes.'),
(3, 3, 'A timeless classic with a gripping story.');